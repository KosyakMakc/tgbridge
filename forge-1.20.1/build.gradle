plugins {
    id "java"
    id "dev.architectury.loom" version "1.5-SNAPSHOT"
    id "org.jetbrains.kotlin.jvm"
    id "org.jetbrains.kotlin.plugin.serialization"
    id "com.github.johnrengelman.shadow"
}

repositories {
    maven { url = 'https://maven.neoforged.net/releases' }
    maven {
        name = 'Kotlin for Forge'
        url = 'https://thedarkcolour.github.io/KotlinForForge/'
        content { includeGroup "thedarkcolour" }
    }
}

dependencies {
    minecraft "com.mojang:minecraft:${minecraft_version}"
    forge "net.neoforged:forge:${minecraft_version}-${neo_version}"
    mappings "net.fabricmc:yarn:${yarn_mappings}:v2"

    implementation "thedarkcolour:kotlinforforge:${forge_kotlin_version}"

    shadow implementation(project(":common"))
}

processResources {
    inputs.property "version", project.version

    filesMatching("META-INF/mods.toml") {
        expand "version": project.version
    }
}

shadowJar {
    dependsOn 'processResources'
    finalizedBy 'remapJar'

    configurations = [project.configurations.shadow]
}

remapJar {
    inputFile = shadowJar.archiveFile
    archiveFileName = "${rootProject.name}-${rootProject.version}-${project.name}.jar"
    destinationDirectory.set(file("../build/release"))
}

artifacts {
    archives remapJar
}

components.java {
    withVariantsFromConfiguration(project.configurations.shadowRuntimeElements) {
        skip()
    }
}
